/**
 * –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–∏—Å—Ç–µ–º—ã –ø–æ–º–æ—â–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
 */
class HelpManager {
    static instructions = {
        1: {
            title: '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –®–∞–≥ 1 - –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∞–∫—Ç–∞',
            content: `
                <h4>üìã –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞</h4>
                <p>–ù–∞ —ç—Ç–æ–º —à–∞–≥–µ –≤—ã —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç–µ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∞–∫—Ç–∞ - –¥–æ–±–∞–≤–ª—è–µ—Ç–µ —Ä–∞–∑–¥–µ–ª—ã, –ø–æ–¥—Ä–∞–∑–¥–µ–ª—ã –∏ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è.</p>
                
                <h4>üîß –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</h4>
                <ul>
                    <li><strong>–ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–µ</strong> - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏</li>
                    <li><strong>–î–æ–±–∞–≤–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç</strong> - —Å–æ–∑–¥–∞—ë—Ç –ø–æ–¥—Ä–∞–∑–¥–µ–ª –≤–Ω—É—Ç—Ä–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞</li>
                    <li><strong>–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç</strong> - —Å–æ–∑–¥–∞—ë—Ç —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ</li>
                    <li><strong>–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É</strong> - –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É –∫–∞–∫ –¥–æ—á–µ—Ä–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç</li>
                    <li><strong>–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫</strong> - –¥–æ–±–∞–≤–ª—è–µ—Ç –±–ª–æ–∫ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞</li>
                    <li><strong>–î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ</strong> - —Å–æ–∑–¥–∞—ë—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–æ–∫ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏—è</li>
                    <li><strong>–£–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç</strong> - —É–¥–∞–ª—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏ –≤—Å–µ—Ö –µ–≥–æ –ø–æ—Ç–æ–º–∫–æ–≤</li>
                </ul>
                
                <h4>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</h4>
                <ul>
                    <li><strong>–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–∏</strong> - –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞</li>
                    <li><strong>Enter</strong> - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</li>
                    <li><strong>Escape</strong> - –æ—Ç–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</li>
                </ul>
                
                <h4>üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:</h4>
                <p>–°–ø—Ä–∞–≤–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∂–∏–≤–æ–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π —Ä–∞–∑–¥–µ–ª–æ–≤.</p>
                
                <h4>‚û°Ô∏è –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É:</h4>
                <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <strong>"–î–∞–ª–µ–µ"</strong> –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞, –∫–æ–≥–¥–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–∞.</p>
            `
        },
        2: {
            title: '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –®–∞–≥ 2 - –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö',
            content: `
                <h4>üìù –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∞–∫—Ç–∞</h4>
                <p>–ù–∞ —ç—Ç–æ–º —à–∞–≥–µ –≤—ã –∑–∞–ø–æ–ª–Ω—è–µ—Ç–µ –¥–∞–Ω–Ω—ã–º–∏ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —à–∞–≥–µ.</p>
                
                <h4>üìä –†–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏:</h4>
                <ul>
                    <li><strong>–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ —è—á–µ–π–∫–µ</strong> - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ</li>
                    <li><strong>Enter</strong> - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π —è—á–µ–π–∫–µ</li>
                    <li><strong>Tab</strong> - –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π —è—á–µ–π–∫–µ</li>
                    <li><strong>–í—ã–¥–µ–ª–µ–Ω–∏–µ —è—á–µ–µ–∫</strong> - –∫–ª–∏–∫ —Å –∑–∞–∂–∞—Ç—ã–º Ctrl –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞</li>
                    <li><strong>–ü—Ä–∞–≤—ã–π –∫–ª–∏–∫</strong> - –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å/—Ä–∞–∑—ä–µ–¥–∏–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —è—á–µ–π–∫–∏</li>
                    <li><strong>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞</strong> - –ø–æ—Ç—è–Ω–∏—Ç–µ –∑–∞ –ø—Ä–∞–≤—ã–π –∫—Ä–∞–π —è—á–µ–π–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —à–∏—Ä–∏–Ω—ã —Å—Ç–æ–ª–±—Ü–∞</li>
                </ul>
                
                <h4>üìÑ –¢–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏:</h4>
                <ul>
                    <li><strong>–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞</strong> - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–∂–∏—Ä–Ω—ã–π, –∫—É—Ä—Å–∏–≤, –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ)</li>
                    <li><strong>–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ</strong> - –≤—ã–±–µ—Ä–∏—Ç–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (—Å–ª–µ–≤–∞, –ø–æ —Ü–µ–Ω—Ç—Ä—É, —Å–ø—Ä–∞–≤–∞)</li>
                    <li><strong>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞</strong> - –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞</li>
                </ul>
                
                <h4>‚ö†Ô∏è –ù–∞—Ä—É—à–µ–Ω–∏—è:</h4>
                <ul>
                    <li><strong>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è</strong> - –Ω–∞—Ä—É—à–µ–Ω–æ, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –æ–ø–∏—Å–∞–Ω–∏–µ, –ø—Ä–∏—á–∏–Ω—ã, –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ</li>
                    <li><strong>–ö–Ω–æ–ø–∫–∏ +/-</strong> - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –æ–ø–∏—Å–∞–Ω–∏—è, –ø—Ä–∏—á–∏–Ω –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π</li>
                </ul>
                
                <h4>üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:</h4>
                <ul>
                    <li><strong>–í—ã–±–æ—Ä —Ñ–æ—Ä–º–∞—Ç–æ–≤</strong> - –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–µ–ª–∫—É —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–æ–π "–°–æ–∑–¥–∞—Ç—å –∞–∫—Ç"</li>
                    <li><strong>–°–æ–∑–¥–∞—Ç—å –∞–∫—Ç</strong> - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö</li>
                    <li><strong>–ì–æ—Ä—è—á–∞—è –∫–ª–∞–≤–∏—à–∞</strong> - <code>Ctrl+S</code> –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</li>
                </ul>
                
                <h4>‚¨ÖÔ∏è –í–æ–∑–≤—Ä–∞—Ç:</h4>
                <p>–ö–Ω–æ–ø–∫–∞ <strong>"–ù–∞–∑–∞–¥"</strong> –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.</p>
            `
        }
    };

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–æ–º–æ—â–∏
     */
    static init() {
        const helpBtn = document.getElementById('helpBtn');
        const modal = document.getElementById('helpModal');

        if (!helpBtn || !modal) {
            console.error('HelpManager: –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã');
            return;
        }

        // –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –ø–æ–º–æ—â–∏
        helpBtn.addEventListener('click', () => {
            this.show();
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                this.hide();
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                this.hide();
            }
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —à–∞–≥–∞
        this.updateTooltip();
    }

    /**
     * –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
     */
    static show() {
        const currentStep = AppState.currentStep || 1;
        const instruction = this.instructions[currentStep];

        if (!instruction) {
            console.error('HelpManager: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–ª—è —à–∞–≥–∞', currentStep);
            return;
        }

        const modal = document.getElementById('helpModal');
        const title = document.getElementById('helpModalTitle');
        const body = document.getElementById('helpModalBody');

        title.textContent = instruction.title;
        body.innerHTML = instruction.content;

        modal.classList.remove('hidden');
    }

    /**
     * –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
     */
    static hide() {
        const modal = document.getElementById('helpModal');
        modal.classList.add('hidden');
    }

    /**
     * –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
     */
    static updateTooltip() {
        const helpBtn = document.getElementById('helpBtn');
        if (!helpBtn) return;

        const currentStep = AppState.currentStep || 1;
        const stepNames = {
            1: '–°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∞–∫—Ç–∞',
            2: '–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö'
        };

        helpBtn.title = `–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –®–∞–≥ ${currentStep} - ${stepNames[currentStep]}`;
    }
}
