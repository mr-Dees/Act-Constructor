/*
 * –°—Ç–∏–ª–∏ –¥–ª—è –≥–∏–ø–µ—Ä—Å—Å—ã–ª–æ–∫ –∏ —Å–Ω–æ—Å–æ–∫ –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö
 */

/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Å—ã–ª–æ–∫ –∏ —Å–Ω–æ—Å–æ–∫ */
.text-link,
.text-footnote {
    position: relative;
    background-color: var(--link-bg);
    color: var(--primary);
    padding: var(--link-footnote-padding) var(--spacing-xs);
    border-radius: var(--radius-xs);
    cursor: pointer;
    transition: var(--transition-all);
    text-decoration: none;
    border-bottom: var(--link-footnote-border-width) dotted var(--link-border);
    display: inline;
    user-select: text;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
.text-link:hover,
.text-footnote:hover {
    background-color: var(--link-bg-hover);
    border-bottom-style: solid;
    border-bottom-color: var(--primary);
}

/* –û—Ç–ª–∏—á–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è —Å–Ω–æ—Å–æ–∫ */
.text-footnote {
    background-color: var(--footnote-bg);
    color: var(--accent);
    border-bottom-color: var(--footnote-border);
}

.text-footnote:hover {
    background-color: var(--footnote-bg-hover);
    border-bottom-color: var(--accent);
}

/* –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
.text-link.editing-mode,
.text-footnote.editing-mode {
    position: relative;
    z-index: var(--z-dropdown);
    padding: var(--spacing-xs) var(--spacing-sm);
    margin: calc(-1 * var(--spacing-xs));
    background-color: var(--bg-primary);
    border: var(--link-footnote-editing-border-width) solid var(--primary);
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow-md);
    transform: translateY(var(--link-footnote-editing-translate));
    cursor: text;
    animation: editingPulse var(--transition-slow) ease;
}

.text-footnote.editing-mode {
    border-color: var(--accent);
}

/* –§–æ–∫—É—Å –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
.text-link.editing-mode:focus,
.text-footnote.editing-mode:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: var(--shadow-lg), 0 0 0 var(--link-footnote-focus-ring-width) var(--primary-subtle);
}

.text-footnote.editing-mode:focus {
    border-color: var(--accent);
    box-shadow: var(--shadow-lg), 0 0 0 var(--link-footnote-focus-ring-width) var(--footnote-focus-shadow);
}

/* Tooltip –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è URL/—Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ */
.link-footnote-tooltip {
    position: fixed;
    background: var(--tooltip-bg);
    color: var(--tooltip-text);
    padding: var(--spacing-sm) var(--spacing);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-xs);
    line-height: var(--line-height-normal);
    max-width: var(--link-tooltip-max-width);
    word-break: break-word;
    z-index: var(--z-tooltip);
    pointer-events: none;
    box-shadow: var(--shadow-md);
    animation: tooltipFadeIn var(--transition-fast) ease;
}

/* –°—Ç—Ä–µ–ª–∫–∞ tooltip */
.link-footnote-tooltip::before {
    content: '';
    position: absolute;
    bottom: 100%;
    left: var(--spacing);
    border: var(--link-tooltip-arrow-size) solid transparent;
    border-bottom-color: var(--tooltip-bg);
}

/* Popup –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
.link-footnote-popup {
    position: fixed;
    background: var(--modal-bg);
    border: var(--border-width-thin) solid var(--modal-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--modal-shadow);
    min-width: var(--link-popup-min-width);
    max-width: var(--link-popup-max-width);
    z-index: var(--z-modal);
    animation: scaleIn var(--transition-base) ease;
}

/* –®–∞–ø–∫–∞ popup */
.link-footnote-popup-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing) var(--spacing-lg);
    border-bottom: var(--border-width-thin) solid var(--border-light);
    background: var(--modal-header-bg);
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

/* –ú–µ—Ç–∫–∞ —Ç–∏–ø–∞ (–°—Å—ã–ª–∫–∞/–°–Ω–æ—Å–∫–∞) */
.link-footnote-popup-label {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

/* –ò–∫–æ–Ω–∫–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ */
.link-footnote-popup-label::before {
    content: 'üîó';
    font-size: var(--font-size-base);
}

.link-footnote-popup[data-type="footnote"] .link-footnote-popup-label::before {
    content: 'üìù';
}

/* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è */
.popup-delete-btn {
    background: transparent;
    border: none;
    color: var(--text-secondary);
    font-size: var(--icon-size-lg);
    cursor: pointer;
    padding: var(--spacing-xs);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-sm);
    transition: var(--transition-all);
    line-height: 1;
}

.popup-delete-btn:hover {
    background: var(--delete-btn-hover-bg);
    color: var(--error);
    transform: scale(1.1);
}

.popup-delete-btn:active {
    transform: scale(var(--button-active-scale));
}

/* –°–æ–¥–µ—Ä–∂–∏–º–æ–µ popup */
.link-footnote-popup-content {
    padding: var(--spacing-lg);
    display: flex;
    flex-direction: column;
    gap: var(--spacing);
}

/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
.popup-field {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

/* –ú–µ—Ç–∫–∞ –ø–æ–ª—è */
.popup-field-label {
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-semibold);
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-wide);
}

/* –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
.link-footnote-popup-text-input,
.link-footnote-popup-input {
    width: 100%;
    padding: var(--spacing-sm) var(--spacing);
    border: var(--border-width-thin) solid var(--input-border);
    border-radius: var(--radius-sm);
    font-family: var(--font-family-base);
    font-size: var(--font-size-sm);
    color: var(--input-text);
    background: var(--input-bg);
    transition: var(--transition-all);
}

.link-footnote-popup-text-input:focus,
.link-footnote-popup-input:focus {
    outline: none;
    border-color: var(--input-border-focus);
    box-shadow: var(--input-shadow-focus);
}

/* Textarea –¥–ª—è URL/—Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å–Ω–æ—Å–∫–∏ */
.link-footnote-popup-input {
    line-height: var(--line-height-normal);
    resize: vertical;
    min-height: var(--link-popup-textarea-min-height);
    max-height: var(--link-popup-textarea-max-height);
}

/* Placeholder */
.link-footnote-popup-input::placeholder,
.link-footnote-popup-text-input::placeholder {
    color: var(--input-placeholder);
    font-style: italic;
}

/* –°–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è textarea */
.link-footnote-popup-input::-webkit-scrollbar {
    width: var(--scrollbar-width);
}

.link-footnote-popup-input::-webkit-scrollbar-track {
    background: var(--scrollbar-bg);
    border-radius: var(--radius-sm);
}

.link-footnote-popup-input::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: var(--radius-sm);
}

.link-footnote-popup-input::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
}

/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –≤ popup */
.link-footnote-popup-actions {
    display: flex;
    gap: var(--spacing-sm);
    justify-content: flex-end;
    padding-top: var(--spacing-sm);
    border-top: var(--border-width-thin) solid var(--border-light);
    margin-top: var(--spacing-xs);
}

/* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ */
.preview-content .text-link,
.preview-content .text-footnote {
    cursor: default;
    pointer-events: none;
}

/* –°—Å—ã–ª–∫–∏ –∏ —Å–Ω–æ—Å–∫–∏ –≤ –ø–∞–Ω–µ–ª–∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ ‚Äî —Ç–æ–ª—å–∫–æ tooltip –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
#preview .text-link,
#preview .text-footnote,
#previewMenu .text-link,
#previewMenu .text-footnote {
    cursor: default;
    pointer-events: auto;
}

/* –ü–æ–¥—Å—á–µ—Ç —Å–Ω–æ—Å–æ–∫ */
.text-footnote::after {
    content: attr(data-footnote-number);
    font-size: var(--link-footnote-number-size);
    vertical-align: super;
    margin-left: var(--link-footnote-number-offset);
    font-weight: var(--font-weight-semibold);
}
