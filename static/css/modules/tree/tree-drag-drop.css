/*
 * Drag & Drop для дерева элементов
 * Визуальная индикация перетаскивания и позиций вставки
 */

/* Стили для элемента во время перетаскивания */
.tree-item.dragging {
    opacity: var(--opacity-dragging);
    cursor: move;
    transform: scale(var(--scale-dragging));
    box-shadow: var(--shadow-xl);
    z-index: var(--z-modal);
}

/* Индикатор вставки перед элементом */
.tree-item.drop-before {
    position: relative;
}

.tree-item.drop-before::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: var(--tree-drop-indicator-height);
    background: var(--insert-indicator-gradient);
    border-radius: var(--radius-sm);
    z-index: var(--z-dropdown);
    transform: translateY(-50%);
    animation: dropIndicatorPulse var(--duration-drop-indicator-pulse) ease-in-out infinite;
    box-shadow: var(--highlight-insert-shadow);
}

/* Индикатор вставки после элемента */
.tree-item.drop-after {
    position: relative;
}

.tree-item.drop-after::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: var(--tree-drop-indicator-height);
    background: var(--insert-indicator-gradient);
    border-radius: var(--radius-sm);
    z-index: var(--z-dropdown);
    transform: translateY(50%);
    animation: dropIndicatorPulse var(--duration-drop-indicator-pulse) ease-in-out infinite;
    box-shadow: var(--highlight-insert-shadow);
}

/* Индикатор вставки как дочерний элемент */
.tree-item.drop-child {
    background-color: var(--drop-child-bg);
    border: var(--border-width-md) dashed var(--drop-child-border);
    border-radius: var(--radius-sm);
    position: relative;
    transform: scale(var(--scale-drop-child));
    box-shadow: var(--shadow-lg);
}

.tree-item.drop-child::before {
    content: '↳ Вставить внутрь';
    position: absolute;
    right: var(--spacing-sm);
    top: 50%;
    transform: translateY(-50%);
    font-size: var(--font-size-xs);
    color: var(--drop-child-border);
    font-weight: var(--font-weight-semibold);
    background-color: var(--bg-primary);
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius-sm);
    z-index: var(--z-sticky);
    pointer-events: none;
    box-shadow: var(--shadow-sm);
}

/* Стили для перетаскиваемых элементов */
.tree-item[draggable="true"]:not(.protected) {
    cursor: grab;
}

.tree-item[draggable="true"]:not(.protected):active {
    cursor: grabbing;
}

/* Индикация возможности перетаскивания */
.tree-item[draggable="true"]:not(.protected):hover::after {
    content: '⋮⋮';
    position: absolute;
    left: var(--spacing-xs);
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-tertiary);
    font-size: var(--font-size-sm);
    opacity: var(--opacity-drag-indicator);
    pointer-events: none;
}

/* Отключаем перетаскивание для защищенных элементов */
.tree-item.protected[draggable="true"] {
    cursor: default;
}

/* Оверлей при перетаскивании над всем деревом */
.tree-container.drag-active {
    outline: var(--border-width-md) dashed var(--primary-light);
    outline-offset: var(--tree-drag-active-offset);
    background: var(--tree-drag-active-bg);
}

/* Подсветка допустимой зоны сброса */
.tree-item.drop-zone:not(.protected) {
    background: var(--tree-drop-zone-bg);
    border-color: var(--primary-light);
    box-shadow: var(--shadow-md);
}
